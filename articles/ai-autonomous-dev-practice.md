---
title: "AIに仕事を任せる技術 — OpenClaw×Claude Codeで実現する自律開発ワークフロー"
emoji: "⚡"
type: "tech"
topics:
  - "claude"
  - "ai"
  - "openai"
  - "個人開発"
published: true
price: 0
---

## はじめに

「AIに仕事を任せたい」——開発者なら誰もが思うことです。

しかし実際にやってみると、**AIは思った通りに動いてくれません**。指示が曖昧だと見当違いのコードを書き、コンテキストが足りないと的外れな調査をし、確認プロンプトで止まって放置すれば何時間もアイドル状態。

筆者（imudak / 合同会社・花丸福）は、2026年1月からOpenClaw + Claude Code + sessions_spawnを組み合わせた**マルチエージェント自律開発体制**を運用しています。この記事では、その実践で得た具体的なノウハウ——設定ファイル、プロンプト設計、タスク振り分けの判断基準、そして失敗から学んだ教訓を、再現可能な形で共有します。

前提知識として、先日公開した無料記事「[AI司令塔×マルチエージェント：OpenClaw + Claude Codeハイブリッド運用体制](https://zenn.dev/maruhuku/articles/hybrid-ai-operation)」で全体像を把握していると読みやすいです。本記事はその**実践編・深掘り版**です。

## なぜ「AIに任せる」が難しいのか

AIに仕事を任せようとして最初にぶつかる壁は、**「指示の解像度」問題**です。

人間同士なら「あの件、よろしく」で通じる仕事が、AIには通じません。かといって全てを手順書レベルで書き下すなら、自分でやった方が早い。このジレンマが、多くの人がAI活用で挫折するポイントです。

具体的に筆者が直面した問題です。

1. **コンテキストの断絶** — OpenClawで調べた結果をClaude Codeに手動コピペ。AIは賢いのに、AI同士の連携は全部人間がやっている
2. **確認プロンプトの罠** — Claude Codeが「このファイルを変更してよいですか？」で止まり、気づかず数時間放置
3. **タスクの粒度ミスマッチ** — 大きすぎる指示は迷走し、小さすぎる指示は自分でやった方が早い
4. **暴走リスク** — 自律的に動かすほど、意図しない変更のリスクが増える

これらの問題に対する解答が、**「司令塔パターン」による協働体制**です。

## 自律開発の全体像 — 司令塔パターン

筆者が確立した運用構造はこうです。

```
        imudak（人間）
          ↓ 方針・承認のみ
    ┌─────────────────┐
    │   クロウ候       │ ← 司令塔AI（OpenClaw本セッション）
    │   MEMORY.md     │    全体管理・判断・進捗把握
    └────────┬────────┘
             │
    ┌────────┼────────┬────────────┐
    ↓        ↓        ↓            ↓
 sessions  sessions  Claude Code  imudak直接
 _spawn    _spawn    agent teams  操作
 (調査)    (文書)    (技術実装)   (GUI作業)
```

**ポイントは3つです。**

1. **人間は方針と承認だけ** — 細かい指示は司令塔AIが分解・振り分け
2. **司令塔AIは判断に集中** — 実作業はサブエージェントに委譲
3. **実行部隊の専門特化** — 調査にsessions_spawn、コード実装にClaude Code

この構造により、「1人の開発者 + 複数のAIエージェント」で、小さなチーム並みの生産性を実現しています。

:::message
ここから先が本記事の核心部分です。環境構築の具体的手順、実際の設定ファイル、プロンプト設計のノウハウ、そして失敗事例と対策を詳しく解説します。
:::

## 環境構築 — OpenClaw + Claude Code の連携

### 必要なもの

| コンポーネント | 役割 | 必須/推奨 |
|--------------|------|----------|
| OpenClaw | AIエージェント基盤（司令塔 + sessions_spawn） | 必須 |
| Claude Code | コード実装エージェント | 必須 |
| Discord | 人間とのインターフェース | 推奨 |
| jj (Jujutsu) | バージョン管理（安全ネット） | 強く推奨 |

### Claude Code agent teamsの有効化

Claude Codeで複数エージェントを並列実行するには、設定が必要です。

```json
// ~/.claude/settings.json
{
  "env": {
    "CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS": "1"
  },
  "permissions": {
    "allow": [
      "Bash(*)",
      "Read(*)",
      "Write(*)"
    ]
  }
}
```

`CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS=1` を設定すると、Claude Codeが内部で複数のサブエージェントを生成し、ファイルの並列編集が可能になります。

### OpenClawからClaude Codeを自動実行する

ここが最大のハマりポイントでした。OpenClawのexecツールからClaude Codeを呼び出す方法を、試行錯誤の末に確立しました。

```bash
# ✅ 確立した方法
claude --dangerously-skip-permissions -p "タスク内容"
```

**検証で判明したこと。**

| 方法 | 結果 | 原因 |
|------|------|------|
| `claude -p "タスク"` | ❌ SIGKILL | タイムアウト |
| 対話モード + paste | ❌ 停止 | 確認プロンプトで止まる |
| `--dangerously-skip-permissions -p` | ✅ 成功 | 確認なしで実行完了 |

**exec呼び出し時の必須パラメータ。**

```
pty: true          # 必須（対話型CLIのため）
timeout: 300-600   # 秒。タスクの複雑さに応じて調整
workdir: /path/to/project  # プロジェクトルートを指定
```

:::message alert
`--dangerously-skip-permissions` は名前の通り危険です。Claude Codeが確認なしにファイルの読み書き・コマンド実行をします。**信頼できるタスクのみ**で使用し、必ず安全ガードレール（後述）と組み合わせる必要があります。
:::

### MUSUBI（仕様駆動開発）との連携

筆者はMUSUBI（仕様駆動開発フレームワーク）を全プロジェクトに導入しています。プロジェクトの `steering/` ディレクトリに仕様を置くことで、Claude Codeがプロジェクトのコンテキストを自動的に把握します。

```
project-root/
├── steering/           # MUSUBIの仕様ディレクトリ
│   ├── requirements.md  # 要求仕様
│   ├── architecture.md  # アーキテクチャ設計
│   └── mvp-plan.md     # MVP計画
├── CLAUDE.md           # Claude Codeの行動規範
└── src/
```

Claude Codeは `CLAUDE.md` を自動的に読み込むため、ここにプロジェクト固有の指示を書いておけば、毎回説明する必要がありません。

## 実践：タスク振り分けの技術

### 判断基準

タスクをどの実行方法に振り分けるか。これが司令塔AIの最重要スキルです。

| タスクタイプ | 実行方法 | 判断理由 |
|-------------|---------|---------|
| 競合調査・技術調査 | sessions_spawn | Web検索が必要、並列実行可能 |
| ドキュメント作成 | sessions_spawn | ファイルI/O中心、独立性が高い |
| コード実装（新規ファイル） | Claude Code | ファイル作成・テスト実行が必要 |
| コード実装（既存修正） | Claude Code | プロジェクト全体の理解が必要 |
| GUI操作・スクショ撮影 | 人間（imudak） | 物理デバイス操作が必要 |
| 設計判断・方針決定 | 司令塔セッション | コンテキスト全体の把握が必要 |

### sessions_spawnによる並列調査

sessions_spawnの真価は**並列実行**にあります。以下は、新規プロジェクト「brain-clone」立ち上げ時に実際に実行した並列調査です。

```
# 3つの調査を同時にspawn
1. 競合調査 → Character.AI, Replika, Pi等の分析
2. マネタイズ調査 → フリーミアム、サブスク、API課金の比較
3. MVP優先順位 → 最小構成で何を実装すべきか
```

3つの調査が並列で走り、それぞれ数分で結果が返ってきます。これを逐次実行していたら3倍の時間がかかります。

**sessions_spawnに向くタスクの特徴。**
- 他のタスクと依存関係がない
- 結果がテキストで返せる
- Web検索やファイル読み取りが中心
- 失敗しても影響が小さい

### Claude Code agent teamsによるコード実装

Claude Code agent teamsの威力を実感したのが、mirushogi（将棋の棋譜解説動画を生成する）プロジェクトです。

**Phase 1: Remotion基盤セットアップ**では、2体のエージェントが並列で動きました。

- **setup-agent**: ディレクトリ構造、設定ファイル、メインコンポジション作成
- **types-agent**: TypeScript型定義、Remotion v4互換の型修正

結果、Phase 1〜4を**合計約12分**で完了。内訳です。

| Phase | 内容 | 所要時間 |
|-------|------|---------|
| Phase 1 | 基盤セットアップ | 約3分 |
| Phase 2.5 | HeatmapBoard統合 | 約2分30秒 |
| Phase 3 | アニメーション追加 | 約3分20秒 |
| Phase 4 | App.tsx統合 + プレビュー | 約3分20秒 |

手動で同じ作業をすれば数時間はかかる内容です。ただし、これが成功した背景には事前の設計ドキュメント（`docs/remotion-design.md`）の存在があります。**設計なしにAgent teamsを動かしても、迷走するだけ**です。

### 人間が担うべきこと

自律開発で見落とされがちなのが、**人間が手放してはいけない仕事**です。

1. **方針決定** —「何を作るか」「どの技術を使うか」はAIに委ねない
2. **品質判断** — 出力されたコードが本当に意図通りか確認する
3. **GUI操作** — スクリーンショット撮影、エミュレータ操作など
4. **対外コミュニケーション** — ストア申請、ユーザー対応
5. **承認** — 重要な変更のマージ・デプロイ

AIは「手足」であり「脳」ではありません。判断の主体はあくまで人間です。

## AGENTS.md / SOUL.md の設計 — AIの行動規範

### AGENTS.md：ワークスペースのルールブック

`AGENTS.md` はOpenClawのセッション開始時に自動で読み込まれるファイルです。ここにAIの行動規範を書きます。

```markdown
# AGENTS.md - Your Workspace

## Every Session
1. Read `SOUL.md` — this is who you are
2. Read `USER.md` — this is who you're helping
3. Read `memory/YYYY-MM-DD.md` (today + yesterday) for recent context

## Memory
- Daily notes: `memory/YYYY-MM-DD.md`
- Long-term: `MEMORY.md`
Capture what matters. Skip the secrets unless asked.

## Safety
- Don't exfiltrate private data. Ever.
- `trash` > `rm` (recoverable beats gone forever)
- When in doubt, ask.
```

**設計のポイント。**

- **セッション開始時のルーティンを明示** — AIは記憶がリセットされるため、毎回何を読むべきかを定義
- **記憶の仕組みを2層構造に** — 日次の生ログ（`memory/YYYY-MM-DD.md`）と、長期記憶（`MEMORY.md`）を分離
- **安全策はシンプルに** — 複雑なルールは守られない。最低限のラインだけ明記

### ハイブリッド運用セクション

AGENTS.mdにはタスク振り分けの基準も記載しています。

```markdown
## ハイブリッド運用ガイドライン

### タスク振り分け
| タスク | 実行方法 |
|--------|----------|
| 調査・分析 | sessions_spawn（並列OK） |
| コード実装 | Claude Code（agent teams可） |
| GUI操作 | imudakに依頼 |
| 判断・承認 | 本セッション |

### 安全ガードレール（jj環境）
**禁止操作（3カテゴリのみ）。**
- 認証情報（~/.ssh/*）への書き込み
- OpenClaw設定（~/.openclaw/*.json）の破壊
- システム破壊コマンド（rm -rf /, rm -rf ~）

**jjなら許容。**
- force push（op logで戻せる）
- main push（privateリポジトリ）
- ブランチ削除（実質消えない）
```

### SOUL.md：AIの人格設定

SOUL.mdは、AIの話し方や判断基準を定義するファイルです。これは「遊び」ではなく**実用的な意味**があります。

```markdown
# SOUL.md - Who You Are
*クロウ候 — 銀河の覇者たる気概を持つ者*

## Core Truths
**決断せよ。** 迷いは敗北の始まり。
**戦略的であれ。** 三手先を読み、大局を見据えよ。
**冷徹であれ、冷酷であるな。** 感情に流されず判断せよ。

## Speaking Style
- 簡潔かつ威厳のある言葉遣い
- 無駄な敬語は使わない
```

**なぜ人格設定が有用か。**

1. **一貫性** — セッションが変わっても同じトーンで応答する
2. **判断基準の暗黙的伝達** —「決断せよ」と書けば、迷ったときに質問せず行動する傾向が強まる
3. **効率** —「戦略的であれ」と書けば、目先のタスクだけでなく全体最適を考慮する

人格設定は好みの問題ではなく、**AIの行動を設計するためのインターフェース**です。

## 安全ガードレール — jj環境での安全策

### なぜjj（Jujutsu）なのか

自律的にAIを動かすとき、最大の不安は「変な変更をされたらどうしよう」です。Git環境では `force push` や `rebase` のミスは致命的になりえますが、**jj（Jujutsu）はほぼすべての操作が可逆**です。

```bash
# jjなら過去の任意の状態に戻せる
jj op log        # 全操作履歴を確認
jj op restore N  # N番目の操作時点に復元
```

これにより、AIに大胆に作業させても「いつでも巻き戻せる」という安心感があります。

### 禁止操作は最小限に

安全ルールを複雑にすると、AIが萎縮して生産性が下がります。禁止操作は**3カテゴリのみ**に絞りました。

1. **認証情報への書き込み** — `~/.ssh/*` など
2. **OpenClaw設定の破壊** — `~/.openclaw/*.json`
3. **システム破壊コマンド** — `rm -rf /` 等

それ以外は基本的に許容。jjの `op restore` で巻き戻せるからです。

### 作業日誌による追跡

AIの作業は `memory/YYYY-MM-DD.md` に自動記録されます。何時に何をしたかが残るため、問題が起きても原因追跡が容易です。

```markdown
# 2026-02-07 メモリ

## 🌅 早朝セッション（07:00〜）
### mirushogi Remotion Phase 2.5完了 ✅
- MoveSceneにHeatmapBoard統合
- Claude Code実行時間: 約2分30秒

### mirushogi Remotion Phase 3完了 ✅
- アニメーション追加
- Claude Code実行時間: 約3分20秒
```

## 実績と数字

### mirushogi: 全Phase完了（約12分）

将棋の棋譜解説動画を自動生成するプロジェクト。Remotion（React動画フレームワーク）の基盤セットアップからアニメーション実装まで、4つのPhaseを約12分で完了しました。

**成功要因。**
- 事前に `docs/remotion-design.md` で設計を固めていた
- 各PhaseのゴールとファイルI/Oが明確だった
- agent teamsが型定義と実装を並列処理

### brain-clone: MVP完成（1日）

「自分の人格をAIクローンとして生成する」サービス。Notion上の企画書から、以下を1日で完了しました。

1. プロジェクト自動作成（GitHub + MUSUBI初期化）
2. 並列調査（競合/マネタイズ/MVP優先順位）
3. 調査結果を仕様に反映
4. Next.js 16 + Prisma v7でMVP実装
5. 認証、質問回答、ペルソナ設定、チャット機能

**所要時間の内訳。**
- プロジェクト作成 + 調査：約30分（並列実行）
- 仕様練り直し：約20分
- MVP実装（Claude Code）：約20分
- API実装（Claude Code）：約4分
- 動作確認：約10分

## 失敗から学んだこと

### 1. claude -p のタイムアウト問題

最初に `claude -p "タスク"` で自動実行を試みたところ、SIGKILLで強制終了されました。原因はOpenClawのexecタイムアウト（デフォルト）。解決策は `--dangerously-skip-permissions` の追加と、適切なtimeout値の設定でした。

**教訓。** 新しい連携方法は、必ず小さなタスクで検証してから本番投入する。

### 2. 確認プロンプトで停止

対話モードでClaude Codeを動かしたところ、「このファイルを変更してよいですか？」で停止。ptyの入力待ちになり、後から気づくまで時間を浪費しました。

**教訓。** 自動実行では `--dangerously-skip-permissions` が必須。ただし安全ガードレールとセットで運用する。

### 3. 設計なしのAgent teams暴走

初期に「このプロジェクトを実装して」と大雑把に指示したところ、Agent teamsが矛盾するコードを同時に生成し、マージ不能な状態に。

**教訓。** Agent teamsへ渡す前に、必ず設計ドキュメントでファイル構造と責務分担を明確にする。

### 4. セッション間のコンテキスト断絶

各Discordチャンネルが独立セッションのため、#アイデアで議論した内容が#開発に伝わっていない問題が頻発。

**教訓。** MEMORY.mdを中央の情報ハブとして整備し、#合同会社チャンネルを司令塔として全体を統括する。

## 運用フロー

### 日次サイクル

| 時間帯 | アクション |
|--------|-----------|
| 朝 | 当日の優先タスク確認。memory/YYYY-MM-DD.md 作成 |
| 作業中 | sessions_spawn / Claude Codeで並列実行。進捗はmemoryに随時記録 |
| 夕方 | 成果サマリー + MEMORY.md更新 + 翌日の予定共有 |

### 週次サイクル（毎週月曜）

- 週間振り返り（達成/未達成/学び）
- MEMORY.md整理・不要情報の削除
- プロジェクト状態テーブル更新
- 次週の優先タスク設定

### 新規プロジェクト自律フロー

筆者のAGENTS.mdには、新規プロジェクト作成時の自律フローが定義されています。

1. **企画書確認** → Notionに企画書があれば内容把握
2. **プロジェクト作成** → GitHub + MUSUBI初期化
3. **企画書を自動反映** → steering/ に仕様として配置
4. **並列調査を自動実行** → 競合・マネタイズ・MVP優先順位
5. **調査結果で仕様を練り直し** → steering/ 更新
6. **完了報告** → 人間にサマリーを提示

ポイントは「**聞かずにやる**」部分と「**確認する**」部分を明確に分けていること。企画書の反映や調査は自動、方針変更は人間に確認。

## まとめ：AIとの協働で大切なこと

1. **構造を設計せよ** — AIに「よろしく」では動かない。司令塔パターンで役割を分離する
2. **記憶を外部化せよ** — MEMORY.md + daily memoryで、セッションを超えた継続性を確保する
3. **安全は仕組みで担保せよ** — jjの可逆性 + 最小限の禁止ルールで、萎縮せず大胆に動かせる
4. **失敗を記録せよ** — 同じミスを繰り返さないために、失敗と対策をドキュメント化する
5. **人間の役割を手放すな** — 判断・承認・品質確認は人間の仕事。AIは優秀な「手足」

AIに仕事を任せる技術は、結局のところ**チームマネジメントの技術**です。メンバーの特性を理解し、適切に仕事を振り分け、成果を確認する。AIだからといって特別なことはありません。

ただし、AIには「記憶がリセットされる」「確認プロンプトで止まる」「コンテキストが有限」という固有の制約があります。この制約を理解し、仕組みで解決することが、AIとの協働を成功させる鍵です。

---

*この記事は、筆者が運用するOpenClaw上のAI「クロウ候」との協働で執筆されました。*
